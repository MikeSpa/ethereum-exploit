# Summary Analysis of the main  exploit on Ethereum

Each exploit has a more detailed analysis in its own folder.

## TempleDAO (2022-10-11)


### The vulnerability: Access control 

Poor access control on the `migrateStake()` function of StaxLPStaking:

```solidity
    /**
     * @notice For migrations to a new staking contract:
     *         1. User/DApp checks if the user has a balance in the `oldStakingContract`
     *         2. If yes, user calls this function `newStakingContract.migrateStake(oldStakingContract, balance)`
     *         3. Staking balances are migrated to the new contract, user will start to earn rewards in the new contract.
     *         4. Any claimable rewards in the old contract are sent directly to the user's wallet.
     * @param oldStaking The old staking contract funds are being migrated from.
     * @param amount The amount to migrate - generally this would be the staker's balance
     */
function migrateStake(address oldStaking, uint256 amount) external {
    StaxLPStaking(oldStaking).migrateWithdraw(msg.sender, amount); //exploit
    _applyStake(msg.sender, amount);
}
```

This function allows **anyone** (missing modifier) to submit **any address** (missing check) as the `oldStaking` parameter.

The first line call `migrateWithdraw` on the *supplied address*, anyone can choose what this functin does (eg nothing at all), and the second line increase the msg.sender's balance on the contract, since the contract thinks that the msg.sender had something staked that was just migrate:
```solidity
function _applyStake(address _for, uint256 _amount) internal updateReward(_for) {
    _totalSupply += _amount;
    _balances[_for] += _amount;
    emit Staked(_for, _amount);
}
```

Once this is done, we can just call `withdrawAll()` which will transfer the given amount of LP tokens to our msg.sender address.
